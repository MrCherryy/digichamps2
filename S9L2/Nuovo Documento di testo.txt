let
    Origine = Excel.Workbook(File.Contents("C:\Users\marco\OneDrive\Documenti\GitHub\digichamps2\S9L2\M3S1E2.xlsx"), null, true),
    Ordini_Sheet = Origine{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(Ordini_Sheet, [PromoteAllScalars=true]),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Modificato tipo",{"Column2", "Column3", "Column9"}),
    #"Rimossi errori" = Table.RemoveRowsWithErrors(#"Rimosse colonne", {"Column8"}),
    #"Rimosse prime righe" = Table.Skip(#"Rimossi errori",2),
    #"Intestazioni alzate di livello1" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello1",{{"COD PROD", type text}, {"Collaboratore", type text}, {"Regione", type text}, {"Column4", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Modificato tipo1", "TOTALE", each [Prezzo unitario] * [Quantità]),
    #"Sostituito valore" = Table.ReplaceValue(#"Aggiunta colonna personalizzata"," ","",Replacer.ReplaceText,{"Regione"}),
    #"Rinominate colonne" = Table.RenameColumns(#"Sostituito valore",{{"Column4", "DATA ORDINE"}}),
    #"Ordinate righe" = Table.Sort(#"Rinominate colonne",{{"Collaboratore", Order.Ascending}}),
    #"Sostituito valore1" = Table.ReplaceValue(#"Ordinate righe"," ","",Replacer.ReplaceValue,{"COD PROD", "Collaboratore", "Regione", "DATA ORDINE", "Categoria", "Prodotto", "Prezzo unitario", "Quantità", "TOTALE"}),
    #"Ordinate righe1" = Table.Sort(#"Sostituito valore1",{{"Collaboratore", Order.Ascending}}),
    #"Secondo Rinomina" = Table.ReplaceValue(#"Ordinate righe1","  Melli Maria","Melli Maria",Replacer.ReplaceText,{"Collaboratore"}),
    #"Ordinate righe2" = Table.Sort(#"Secondo Rinomina",{{"Collaboratore", Order.Ascending}}),
    #"Primo Rimonina" = Table.TransformColumns(#"Ordinate righe2",{{"Collaboratore", Text.Trim, type text}, {"Categoria", Text.Trim, type text}}),
    #"Testo troncato1" = Table.TransformColumns(Table.TransformColumnTypes(#"Primo Rimonina", {{"DATA ORDINE", type text}, {"Prezzo unitario", type text}, {"Quantità", type text}, {"TOTALE", type text}}, "it-IT"),{{"COD PROD", Text.Trim, type text}, {"Collaboratore", Text.Trim, type text}, {"Regione", Text.Trim, type text}, {"DATA ORDINE", Text.Trim, type text}, {"Categoria", Text.Trim, type text}, {"Prodotto", Text.Trim, type text}, {"Prezzo unitario", Text.Trim, type text}, {"Quantità", Text.Trim, type text}, {"TOTALE", Text.Trim, type text}}),
    #"Sostituito valore3" = Table.ReplaceValue(#"Testo troncato1",null,"0",Replacer.ReplaceValue,{"Quantità"}),
    #"Caratteri iniziali inseriti" = Table.AddColumn(#"Sostituito valore3", "Caratteri iniziali", each Text.Start([COD PROD], 4), type text),
    #"Rinominate colonne1" = Table.RenameColumns(#"Caratteri iniziali inseriti",{{"Caratteri iniziali", "CIFRE"}}),
    #"Filtrate righe" = Table.SelectRows(#"Rinominate colonne1", each ([Collaboratore] <> "Fove Anna")),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Filtrate righe",{{"TOTALE", type number}, {"Quantità", type number}, {"Prezzo unitario", type number}}),
    #"Aggiunta colonna personalizzata1" = Table.AddColumn(#"Modificato tipo2", "IVA", each [TOTALE] * 0.22),
    #"Modificato tipo3" = Table.TransformColumnTypes(#"Aggiunta colonna personalizzata1",{{"IVA", type number}}),
    #"Inserita colonna combinata" = Table.AddColumn(#"Modificato tipo3", "CATPROD", each Text.Combine({[Categoria], [Prodotto]}, ""), type text),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Inserita colonna combinata", "Colonna SE", each if [Quantità] > 20 then "TROVATO" else " "),
    #"Filtrate righe1" = Table.SelectRows(#"Colonna condizionale aggiunta", each ([Colonna SE] = "TROVATO")),
    #"Testo in maiuscolo" = Table.TransformColumns(#"Filtrate righe1",{{"Regione", Text.Upper, type text}})
in
    #"Testo in maiuscolo"